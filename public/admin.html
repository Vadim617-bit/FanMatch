<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>Адмінка</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <header>
    <h1>Панель адміністратора</h1>
    <div id="user-info"></div>
    <button id="logoutBtn" class="btn">Вийти</button>
  </header>

  <main id="admin-panels" class="hidden">
    <section>
      <h2>Пости</h2>
      <form id="createPostForm">
        <input type="text" id="postTitle" placeholder="Заголовок" required>
        <textarea id="postContent" placeholder="Текст" required></textarea>
        <button type="submit" class="btn">Створити пост</button>
      </form>
      <div id="postsList"></div>
    </section>

    <section>
      <h2>Події</h2>
      <form id="createEventForm">
        <input type="text" id="eventTitle" placeholder="Назва" required>
        <input type="text" id="eventLocation" placeholder="Локація" required>
        <input type="datetime-local" id="eventTime" required>
        <button type="submit" class="btn">Створити подію</button>
      </form>
      <div id="eventsList"></div>
    </section>
  </main>

  <script src="/auth.js"></script>
  <script src="/js/admin.js" defer></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const token = localStorage.getItem('token');
      if (!token) {
        window.location.href = "/admin-login.html";
        return;
      }

      axios.get('/verify-admin', { headers: { 'Authorization': `Bearer ${token}` } })
        .then(res => {
          if (!res.data.isAdmin) {
            window.location.href = "/admin-login.html";
          } else {
            document.getElementById('admin-panels').classList.remove('hidden');
            document.getElementById('user-info').textContent = `Вітаємо, ${res.data.username}`;
          }
        })
        .catch(err => {
          console.error("Authorization error:", err);
          window.location.href = "/admin-login.html";
        });

      document.getElementById('logoutBtn').addEventListener('click', () => {
        localStorage.removeItem('token');
        localStorage.removeItem('userId');
        localStorage.removeItem('username');
        window.location.href = "/admin-login.html";
      });
    });
  </script>
</body>
</html>
